# calc_go

Проект для калькулятора, предоставляющего HTTP-API для вычисления математических выражений.

## Описание

Сервис предоставляет один эндпоинт `/api/v1/calculate`, куда можно отправить POST-запрос с математическим выражением. Сервис возвращает результат вычисления выражения или ошибку, если выражение некорректно.

Логирование запросов и ответов реализовано с помощью библиотеки **zap**.

## Использование API

### Эндпоинт /api/v1/calculate

**Описание**: Принимает POST-запрос с телом, содержащим математическое выражение, и возвращает результат вычисления или ошибку.

**Тело запроса (JSON):**

```json
{
  "expression": "2 + 2"
}
```

#### Возможные статусы ответа

**Код 200 (Успех)**
Если выражение верное вы получите статус 200.

Пример запроса с верным выражением:
```bash
curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2+2*2"
}'
```
Ответ:
```json
{
  "result": 6
}
```

**Код 422 (Невалидное выражение)**
Если выражение неверное, например, незавершенное, вы получите ошибку 422.

Пример запроса с ошибочным выражением:
```bash
curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2+2*"
}'
```
Ответ:
```json
{
  "error": "Expression is not valid"
}
```

**Код 500 (Внутренняя ошибка сервера)**
Если при обработке выражения происходит ошибка на сервере, например, пустое тело запроса, вернется ошибка 500.

Пример запроса с ошибочным выражением:
```bash
curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{}'
```
Ответ:
```json
{
  "error": "Internal server error"
}
```

## Логирование

**Описание**: логи записываются с использованием библиотеки **zap** и включают:
- HTTP метод запроса
- Путь запроса
- Время выполнения запроса
- Статус код ответа
- Тело ответа

**Пример логирования**:
```json
{
  "level": "info",
  "ts": 1734773394.6280413,
  "caller": "logging/logger.go:54",
  "msg": "HTTP request",
  "method": "POST",
  "path": "/api/v1/calculate",
  "duration": 0,
  "status_code": 200,
  "response_body": "{\"result\":42}\n"
}
```

## Инструкция по установке и запуску проекта

### Установка

1. Склонируйте репозиторий:
```bash
git clone https://github.com/NeF2le/calc_go.git
```

2. Перейдите в директорию проекта:
```bash
cd .../calc_go
```

3. Установите зависимости:
```bash
go mod tidy
```

### Запуск

По умолчанию сервер запускается на порту 8080. Чтобы запустить сервер, выполните следующую команду:
```bash
go run cmd/main.go
```

Если хотите запустить сервер на другом порту, задайте переменную окружения PORT перед запуском:
```bash
PORT=3000 go run cmd/main.go
```



